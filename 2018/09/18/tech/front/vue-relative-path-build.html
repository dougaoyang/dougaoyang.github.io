<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="这里记录了我在编程时遇到的一些问题，和解决这些问题的一些方法。还有一些是我对编程的一些看法观点，以及学习语言时的一些笔记和心得体会。"><title>vue在非项目根目录上部署的问题和解决方案 | DeepCode</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><meta name="generator" content="Hexo 4.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">vue在非项目根目录上部署的问题和解决方案</h1><a id="logo" href="/.">DeepCode</a><p class="description">高岸为谷，深谷为陵</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/tags/"><i class="fa fa-tag"> 标签</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">vue在非项目根目录上部署的问题和解决方案</h1><div class="post-meta">Sep 18, 2018<span> | </span><span class="category"><a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 983</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-hourglass-half"></i><span class="post-count"> 3</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="post-content"><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p><code>vue-router</code> 有两种模式，默认是hash模式，通过URL的hash来模拟URL。</p>
<p>hash模式生成的URL有点丑，还有另一种history模式，它是利用<code>history.pushState</code>API来模拟URL。</p>
<p>这两种模式在开发环境下都没有什么太大的问题，但是当部署到生产环境中后，两者有所不同。</p>
<p>hash模式部署没有什么问题，只要访问到服务器上的<code>index.html</code>，就可以访问网站了。<br>重点是history模式。</p>
<h2 id="根目录下"><a href="#根目录下" class="headerlink" title="根目录下"></a>根目录下</h2><p>当项目部署在根目录下时，vue的配置文件默认不需要修改，我们要修改的是服务器的配置，这里我们使用nginx。<br>官方提供了解决方案<a href="https://router.vuejs.org/zh/guide/essentials/history-mode.html" target="_blank" rel="noopener">router.vuejs.org/zh…</a></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line">  <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>稍微解释一下</p>
<p><code>$uri</code>就是访问的url，不包含域名和querystring，例如<code>/test/hello</code><br>当访问<code>$uri</code>时，如果存在，则访问<code>$uri/</code>, 不存在就访问<code>/index.html</code><br>这样配置好，访问<code>http://example.com/</code>时就可以访问到网站了，进入多级目录后刷新页面也不会存在问题。</p>
<h2 id="非根目录下"><a href="#非根目录下" class="headerlink" title="非根目录下"></a>非根目录下</h2><p>当然，有时候我们并不想单独申请一个域名或者设置一个子域名来部署网站，这时，就需要修改一下vue的配置文件了</p>
<h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><p>这里我们定义几个环境<br>我们的域名：<code>http://example.com/</code></p>
<p>nignx的root目录：<code>/usr/local/nginx/html/</code> </p>
<p>vue网站目录：<code>/usr/local/nginx/html/h5/main/</code></p>
<p>vue网站访问地址：<code>http://example.com/h5/main/</code></p>
<p>vue网站主页访问地址：<code>http://example.com/h5/main/index.html</code></p>
<p>vue网站静态文件目录：<code>http://example.com/h5/main/static/</code></p>
<p><strong>1. 打包后静态资源的路径需要修改</strong></p>
<p>修改<code>config/index.js</code>文件的build节点下的<code>assetsPublicPath</code></p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">build</span>: &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="attribute">assetsSubDirectory</span>: <span class="string">'static'</span>,</span><br><span class="line">    <span class="attribute">assetsPublicPath</span>: <span class="string">'./'</span>  <span class="comment">// 未修改前的配置为 '/'，</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很多人直接修改成<code>./</code>这样的相对路径是有问题的。</p>
<p>这种当我们访问<code>http://example.com/h5/main/test</code>这样的目录时，<code>./static/</code>就是表示<code>static</code>目录在这一级<code>http://example.com/h5/main/static</code>，这样没有问题。</p>
<p>当我们访问多级目录时，例如<code>http://example.com/h5/main/test/test</code>，<code>./static/</code>就是表示<code>static</code>目录在这一级<code>http://example.com/h5/main/test/static</code>，这路径明显是不正确，访问不到。</p>
<p>这里我们需要改成绝对路径。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">build</span>: &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="attribute">assetsSubDirectory</span>: <span class="string">'static'</span>,</span><br><span class="line">    <span class="attribute">assetsPublicPath</span>: <span class="string">'/h5/main/'</span>  <span class="comment">// 未修改前的配置为 '/'，</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样静态文件目录就始终在<code>http://example.com/h5/main/static/</code>这个路径了。</p>
<p><strong>2. 路由文件需要修改</strong></p>
<p>在路由的history模式下，所有的路由都是基于根路径的，如/xxxx，现在我们时部署到<code>/h5/main/</code>下，我们就要基于这个来修改路由。</p>
<p><code>vue-router</code>有一个<code>base</code>属性 <a href="https://router.vuejs.org/zh/api/#base" target="_blank" rel="noopener">https://router.vuejs.org/zh/…</a></p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">base</span></span><br><span class="line"><span class="keyword">类型: </span><span class="keyword">string</span></span><br><span class="line"><span class="keyword">默认值: </span><span class="string">"/"</span></span><br><span class="line">应用的基路径。例如，如果整个单页应用服务在 /app/ 下，然后 <span class="keyword">base </span>就应该设为 <span class="string">"/app/"</span></span><br></pre></td></tr></table></figure>

<p>修改路由代码</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  mode: <span class="string">'history'</span>,</span><br><span class="line">  <span class="keyword">base</span>: <span class="string">'/h5/main/'</span>, <span class="comment">// 这是新加的配置</span></span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这样打包部署时就可以了，但是开发环境下这个就不对了，所以我们还要根据环境修改一下文件。</p>
<p><code>config/prod.env.js</code>生产环境变量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = &#123;</span><br><span class="line">  NODE_ENV: <span class="string">'"production"'</span>,</span><br><span class="line">  ROUTER_BASE: <span class="string">'"/h5/main/"'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>config/dev.env.js</code>生产环境变量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = &#123;</span><br><span class="line">  NODE_ENV: <span class="string">'"production"'</span>,</span><br><span class="line">  ROUTER_BASE: <span class="string">'"/"'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>路由代码</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  mode: <span class="string">'history'</span>,</span><br><span class="line">  <span class="keyword">base</span>: process.env.ROUTER_BASE, <span class="comment">// 这是新加的配置</span></span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>至此，打包配置的相关修改已全部完成，项目也能够正常访问。</p>
<p>但还是会有一个问题，跳转到某个路由后，刷新页面，就gg了，页面为空白，此时就要修改nginx的配置了。</p>
<h3 id="nginx配置修改"><a href="#nginx配置修改" class="headerlink" title="nginx配置修改"></a>nginx配置修改</h3><p>官方给的nginx配置是根目录下的，需要修改一下</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location ~ <span class="regexp">/h5/m</span>ain &#123;</span><br><span class="line">    try_files <span class="variable">$uri</span> <span class="variable">$uri</span><span class="regexp">/ /</span>h5<span class="regexp">/main/i</span>ndex.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>/h5/main/</code>就是部署的网站目录。</p>
<p>这样几项配置后，就可以在子目录下访问网站，刷新也没有问题。</p>
</div><div class="tags"><a href="/tags/vue/">vue</a></div><div class="post-nav"><a class="pre" href="/2019/12/29/tech/machine_learning/supervised_learning.html">监督学习与非监督学习</a><a class="next" href="/2017/10/17/life/2017-nanjing-marathon.html">2017南京马拉松</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB/">生活</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/%E9%A9%AC%E6%8B%89%E6%9D%BE/" style="font-size: 10px;">马拉松</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/mysql/" style="font-size: 11.25px;">mysql</a> <a href="/tags/javascript/" style="font-size: 18.75px;">javascript</a> <a href="/tags/bootstrap/" style="font-size: 10px;">bootstrap</a> <a href="/tags/HTML/" style="font-size: 11.25px;">HTML</a> <a href="/tags/vue/" style="font-size: 10px;">vue</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size: 20px;">机器学习</a> <a href="/tags/%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0/" style="font-size: 16.25px;">监督学习</a> <a href="/tags/%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92/" style="font-size: 12.5px;">逻辑回归</a> <a href="/tags/%E9%9D%9E%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0/" style="font-size: 15px;">非监督学习</a> <a href="/tags/%E7%AE%97%E6%B3%95%E4%BC%98%E5%8C%96/" style="font-size: 12.5px;">算法优化</a> <a href="/tags/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/" style="font-size: 13.75px;">线性回归</a> <a href="/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/" style="font-size: 12.5px;">神经网络</a> <a href="/tags/SVM/" style="font-size: 11.25px;">SVM</a> <a href="/tags/PHP/" style="font-size: 10px;">PHP</a> <a href="/tags/python/" style="font-size: 17.5px;">python</a> <a href="/tags/pandas/" style="font-size: 13.75px;">pandas</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 12.5px;">数据结构</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/05/24/tech/python/structure/str-search-and-kmp.html">字符串朴素匹配算法和KMP算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/03/tech/python/structure/josephus-solve.html">约瑟夫（Josephos）问题以及解法</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/31/tech/python/structure/link-intro.html">链表介绍及python的实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/09/tech/machine_learning/learn_large_datasets.html">在大数据下应用机器学习算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/08/tech/machine_learning/mini_batch_gradient_descent.html">小批量梯度下降算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/08/tech/machine_learning/stochastic_gradient_descent.html">随机梯度下降算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/08/tech/machine_learning/recommender_system.html">推荐系统和协同过滤算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/07/tech/machine_learning/anomaly_detection.html">异常检测（Anomaly Detection）</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/06/tech/machine_learning/dimensionality_reduction.html">PCA降维算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/06/tech/machine_learning/k_means_intro.html">K均值算法介绍</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://www.jianshu.com/u/f133ca80001f" title="爱吃鱼的夏侯莲子" target="_blank">爱吃鱼的夏侯莲子</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">DeepCode</a>&nbsp;|&nbsp;<a href="http://www.beian.miit.gov.cn/" target="_blank" rel="noopener">苏ICP备20021898号-1</a>&nbsp;|&nbsp;<img class="nofancybox" src="../images/beian/icon.png" style="margin-bottom: -4px;"/><a href="http://www.beian.gov.cn/" target="_blank" rel="noopener">苏公网安备 32059002003042号</a><div class="ss"> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>